<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>To Trace a Message Through a Route</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="description" content="This tutorial walks you through the process of tracing a message through a route."><meta name="keywords" content="Apache Camel, Open Source, open source, Fuse, Red Hat, EIP, Enterprise Integration Patterns"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="RiderTutorials.html" title="Tutorials"><link rel="prev" href="RiderTutorialCBR.html" title="To Add a Content-Based Router"><link rel="next" href="RiderTutorialJUnit.html" title="To Test a Route with JUnit"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RiderTutorialTrace"></a>To Trace a Message Through a Route</h1></div><div><div class="abstract"><p>This tutorial walks you through the process of tracing a message through a
                route.</p></div></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e11750"></a>Goals</h2></div></div></div><p>In this tutorial you will:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>run the CBRroute in the <span class="guilabel">Fuse Integration</span>
                    perspective</p></li><li class="listitem"><p>enable tracing on the CBRroute</p></li><li class="listitem"><p>drop messages onto the CBRroute and track them through all route nodes</p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e11768"></a>Prerequisites</h2></div></div></div><p>To complete this tutorial you will need the <code class="filename">CBRroute</code> project you
            updated in <a class="xref" href="">???</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you skipped any tutorial after <a class="xref" href="RiderTutorialCreate.html" title="To Create a New Route"><i>To Create a New Route</i></a>, you can use the
                prefabricated <code class="filename">camelContext6.xml</code> file to work through this
                tutorial (for details, see <a class="xref" href="">???</a>).</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e11788"></a>Accessing Fuse Integration perspective</h2></div></div></div><p>To open <span class="guilabel">Fuse Integration</span> perspective and optimally arrange its
            layout:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Select <span class="guimenu">Window</span> &gt; <span class="guisubmenu">Open Perspective</span> &gt; <span class="guimenuitem">Other...</span> &gt; <span class="guimenuitem">Fuse Integration</span> to open the <span class="guilabel">Fuse Integration</span> perspective, as
                    shown in <a class="xref" href="RiderTutorialTrace.html#RiderTutorialFIperspect" title="Figure&nbsp;19.&nbsp;Fuse Integration perspective">Figure&nbsp;19</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can use the <span class="guilabel">Open Perspective</span> icon (<span class="inlinemediaobject"><img src="./images/new_persp.png" alt="Open Perspective icon"></span>) in the perspectives tab to access the list of
                        available perspectives.</p></td></tr></table></div><div class="figure"><a name="RiderTutorialFIperspect"></a><p class="title"><b>Figure&nbsp;19.&nbsp;Fuse Integration perspective</b></p><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="495"><tr><td align="center"><img src="./images/ftTutFIP6_2.png" align="middle" width="495" alt="Fuse Integration perspective layout"></td></tr></table></div></div></div><br class="figure-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>To make it easy to access a Camel Context <code class="literal">.xml</code> file, especially when a project consists of multiple contexts, the tooling lists them in
                    the <code class="filename">Camel Contexts</code> folder, beneath the project's root folder in <span class="guilabel">Project Explorer</span>; for
                    example:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="./images/TutCamelContextsFolderPE.png" align="middle" width="105.3"></div></div></td></tr></table></div></li><li class="step"><p>Drag the <span class="guilabel">Diagram View</span> tab and the <span class="guilabel">Shell</span> tab, located
                    to the left of the <span class="guilabel">JMX Navigator</span> tab, and drop them to the
                    right of the <span class="guilabel">JMX Navigator</span> tab, as shown in <a class="xref" href="RiderTutorialTrace.html#RiderTutorialFIPrearranged" title="Figure&nbsp;20.&nbsp;Fuse Integration perspective rearranged">Figure&nbsp;20</a>.</p><div class="figure"><a name="RiderTutorialFIPrearranged"></a><p class="title"><b>Figure&nbsp;20.&nbsp;Fuse Integration perspective rearranged</b></p><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="495"><tr><td align="center"><img src="./images/ftTutFIPrearrange.png" align="middle" width="495" alt="Fuse Integration perspective rearranged layout"></td></tr></table></div></div></div><br class="figure-break"><p>This layout will provide more space for <span class="guilabel">Diagram View</span> to
                    display the route's nodes in a graphical representation, enabling you to
                    visually trace the path that messages take in traversing the routing context. </p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e11884"></a>Starting message tracing</h2></div></div></div><p>To start message tracing on the CBRroute project:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In <span class="guilabel">Project Explorer</span>, expand the
                        <code class="filename">CBRroute</code> project to expose the
                        <code class="filename">src/main/resources/OSGI-INF/blueprint/camelContext.xml</code>
                    file.</p></li><li class="step"><p>Select <span class="guimenu">Run As</span> &gt; <span class="guimenuitem">Local Camel Context (without tests)</span> from the <code class="filename">camelContext.xml</code> file's context
                    menu.</p></li><li class="step"><p>In <span class="guilabel">JMX Navigator</span>, expand <span class="guilabel">Local
                        Processes</span>.</p></li><li class="step"><p>Double click <code class="filename">Local Camel
                        Context[<em class="replaceable"><code>Id</code></em>][Disconnected]</code> to connect
                    to it and expand the elements of your route, as shown in <a class="xref" href="RiderTutorialTrace.html#RiderTutMavenExpand" title="Figure&nbsp;21.&nbsp;Route elements in JMX Navigator">Figure&nbsp;21, &#8220;Route elements in JMX Navigator&#8221;</a>.</p><div class="figure"><a name="RiderTutMavenExpand"></a><p class="title"><b>Figure&nbsp;21.&nbsp;Route elements in JMX Navigator</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="./images/tutTraceStart.png" align="middle" width="260" alt="Route expansion in Fuse JMX Navigator"></div></div></div><br class="figure-break"></li><li class="step"><p>Right-click the <span class="guimenuitem">blueprintContext</span> node to open the
                    context menu, and select <span class="guimenuitem">Start Tracing</span>.</p><p>The tooling displays a graphical representation of your route in
                        <span class="guilabel">Diagram View</span>, as shown in <a class="xref" href="RiderTutorialTrace.html#RiderTutDiagrmaNodes" title="Figure&nbsp;22.&nbsp;Routes' graphical representation">Figure&nbsp;22</a>.</p><div class="figure"><a name="RiderTutDiagrmaNodes"></a><p class="title"><b>Figure&nbsp;22.&nbsp;Routes' graphical  representation</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/tutDiagramNodes.png" align="middle" width="354.5" alt="Diagram View: graphical representation of the routes"></div></div></div><br class="figure-break"></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e11968"></a>Dropping messages on the running CBRroute project</h2></div></div></div><p>To drop messages on the running CBRroute project:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In <span class="guilabel">Project Explorer</span>, expand
                        <code class="code">CBRroute/src/data</code>, so you can access the message files
                        (<code class="code">message1.xml</code> through <code class="code">message6.xml</code>), as shown in
                    <a class="xref" href="RiderTutorialTrace.html#RiderTutDataExpand" title="Figure&nbsp;23.&nbsp;Message files in CBRroute project">Figure&nbsp;23, &#8220;Message files in CBRroute project&#8221;</a>.</p><div class="figure"><a name="RiderTutDataExpand"></a><p class="title"><b>Figure&nbsp;23.&nbsp;Message files in CBRroute project</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/tutMsgFiles.png" align="middle" width="114.75" alt="Message source files in CBRroute project"></div></div></div><br class="figure-break"></li><li class="step"><a name="msg1drag"></a><p>Drag <code class="code">message1.xml</code> and drop it on the
                        <code class="code">blueprintContext&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
                    <span class="guilabel">JMX Navigator</span>, as shown in <a class="xref" href="RiderTutorialTrace.html#tutblueprntExpand" title="Figure&nbsp;24.&nbsp;Local Camel Context tree expanded to input source node">Figure&nbsp;24</a>.</p><div class="figure"><a name="tutblueprntExpand"></a><p class="title"><b>Figure&nbsp;24.&nbsp;Local Camel Context tree expanded to input source node</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="./images/tutblueprintCntxtExpand.png" align="middle" width="92.05" alt="Local Camel Context tree expanded to source file input node"></div></div></div><br class="figure-break"><p>As the message traverses the route, the tooling traces and records its passage
                    at each step.  To update <span class="guilabel">Diagram View</span> with the new message
                    count, you need to click the <code class="code">blueprintContext</code> node in <span class="guilabel">JMX
                        Navigator</span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="filename">Local Camel Context[xxx]</code> tree collapses to the
                            <code class="filename">blueprintContext</code> node after you drop the next
                        message on the input src node. You need not re-expand it. When dragging the
                        other messages, hover over each node in the tree to expose the next node,
                        until you reach the <code class="filename">src/data?noop=true</code> node. Then drop
                        the message on it. This method prevents the tooling from redrawing the
                        graphical representation in <span class="guilabel">Diagram View</span>.</p></td></tr></table></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12049"></a>Initializing and configuring Messages View</h2></div></div></div><p>You need to initialize <span class="guilabel">Messages View</span> before it will display
            message traces. You also need to configure the columns in <span class="guilabel">Messages
                View</span> to persist across all message traces.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Switch from <span class="guilabel">Console</span> to <span class="guilabel">Messages View</span>.</p></li><li class="step"><p>Click the <code class="filename">blueprintContext</code> node in <span class="guilabel">JMX Navigator</span> to
                    initialize <span class="guilabel">Messages View</span> with
                    <code class="filename">message1.xml</code>'s details.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can control columnar layout in all of the tooling's tables. Use the
                        drag method to temporarily rearrange tabular format. For example, drag a
                        column's border rule to expand or contract its width. To hide a column,
                        totally contract its borders. Drag the column header to relocate a column
                        within the table. For your arrangement to persist, you must use the <span class="guimenu">View Menu</span> &gt; <span class="guisubmenu">Configure Columns...</span> method instead. </p></td></tr></table></div></li><li class="step"><p>In <span class="guilabel">Messages View</span>, click the <span class="inlinemediaobject"><img src="images/ViewMnuIcon.png" alt="View Menu icon"></span> icon on the panel's menu bar, and select
                        <span class="guisubmenu">Configure Columns...</span> to open the
                        <span class="guisubmenu">Configure Columns</span> wizard, as shown in <a class="xref" href="RiderTutorialTrace.html#CnfigColsDefault" title="Figure&nbsp;25.&nbsp;Configure Columns defaults">Figure&nbsp;25</a>.</p><div class="figure"><a name="CnfigColsDefault"></a><p class="title"><b>Figure&nbsp;25.&nbsp;Configure Columns defaults</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="./images/TutConfigColsDefaults.png" align="middle" width="152.09999999999997" alt="Configure Columns defaults"></div></div></div><br class="figure-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Notice that the message header, <code class="filename">Destination</code>, which you
                    set for the messages in your routing context, appears in the list.</p></td></tr></table></div><p>You can include or exclude items from <span class="guilabel">Messages View</span> by
                    selecting or deselecting them. You can rearrange the columnar order in which
                    items appear in <span class="guilabel">Messages View</span> by highlighting individual,
                    selected items and moving them up or down in the list.</p></li><li class="step"><p>In the <span class="guilabel">Configure Columns</span> wizard, select and order the
                    items as shown in <a class="xref" href="RiderTutorialTrace.html#CnfigColsSet" title="Figure&nbsp;26.&nbsp;Configure Columns set">Figure&nbsp;26</a>.</p><div class="figure"><a name="CnfigColsSet"></a><p class="title"><b>Figure&nbsp;26.&nbsp;Configure Columns set</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="./images/tutMsgVCnfgColsMnu.png" align="middle" width="161.55" alt="Configure Columns set"></div></div></div><br class="figure-break"><p>These items and their order will persist in <span class="guilabel">Messages View</span>
                    until you change them again.</p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12154"></a>Arranging Diagram View</h2></div></div></div><p>To see all message flow paths clearly, you'll probably need to rearrange the nodes
            by dragging them to fit neatly in <span class="guilabel">Diagram View</span>. You may also need
            to adjust the size of the other views and tabs in Red Hat JBoss Developer Studio to
            allow <span class="guilabel">Diagram View</span> to expand.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12165"></a>Stepping through message traces</h2></div></div></div><p>To step through the message traces:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In <span class="guilabel">Messages View</span>, click the <span class="inlinemediaobject"><img src="./images/refresh.png"></span> (Refresh button) on top, right of the panel's menu bar to
                    populate the view with <code class="filename">message1.xml</code>'s message
                    traces.</p><p>Each time you drop a message on the input <code class="filename">src</code> node in <span class="guilabel">JMX
                    Navigator</span>, you need to refresh <span class="guilabel">Messages View</span>
                    to populate it with the message traces.</p></li><li class="step"><a name="msgView"></a><p>Click one of the message traces to see more details about it in
                <span class="guilabel">Properties</span> view, as shown in <a class="xref" href="RiderTutorialTrace.html#msgTraceselected" title="Figure&nbsp;27.&nbsp;Message trace selected">Figure&nbsp;27</a>.</p><div class="figure"><a name="msgTraceselected"></a><p class="title"><b>Figure&nbsp;27.&nbsp;Message trace selected</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="./images/tutTraceDetails2.png" align="middle" width="484.65000000000003" alt="Message trace selected"></div></div></div><br class="figure-break"><p>The tooling displays the details about a message trace (including message
                    headers when they are set) in the top half of the
                        <span class="guilabel">Properties</span> panel and the contents of the message
                    instance in the bottom half of the <span class="guilabel">Properties</span> panel. So, if
                    your application sets headers at any step within a route, you can check the
                        <span class="guilabel">Message Details</span> to see whether they were set as
                    expected.</p><p>You can step through the message instances by highlighting each one to see how
                    a particular message traversed the route and whether it was processed as
                    expected at each step in the route.</p><p>In <span class="guilabel">Diagram View</span>, the associated step in the route is
                    highlighted, as shown in <a class="xref" href="RiderTutorialTrace.html#msgTraceNode" title="Figure&nbsp;28.&nbsp;Diagram View: message trace node">Figure&nbsp;28</a>.</p><div class="figure"><a name="msgTraceNode"></a><p class="title"><b>Figure&nbsp;28.&nbsp;Diagram View: message trace node</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="./images/TutMsgTraceDiagNode.png" align="middle" width="318.40000000000003" alt="Diagram View: message trace node"></div></div></div><br class="figure-break"></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12235"></a>Finishing up</h2></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Drag <code class="code">message2.xml</code> and drop it on
                        the<code class="code">blueprintContext&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
                        <span class="guilabel">JMX Navigator</span>.</p><p>Hover over each node in the tree until you expose the
                        <code class="filename">src/data?noop=true</code> node, then drop
                        <code class="code">message2.xml</code> on it.</p></li><li class="step"><p>Switch from <span class="guilabel">Console</span> to <span class="guilabel">Messages
                    View</span>.</p></li><li class="step"><p>In <span class="guilabel">Messages View</span>, click the <span class="inlinemediaobject"><img src="./images/refresh.png"></span> (Refresh button) on top, right of the panel's menu bar to
                    populate the view with <code class="filename">message2.xml</code>'s message
                    traces.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can repeat <a class="xref" href="RiderTutorialTrace.html#msg1drag" title="Step 2">Step 2</a>
                        through <a class="xref" href="RiderTutorialTrace.html#msgView" title="Step 2">Step 2</a> for the
                        remaining messages in <code class="filename">CBRroute/src/data/</code> at any time,
                        as long as tracing remains enabled.</p><p>On each subsequent drop, remember to click the <span class="inlinemediaobject"><img src="./images/refresh.png"></span> (Refresh button) on the panel's menu bar to populate
                            <span class="guilabel">Messages View</span> with the new message traces.</p></td></tr></table></div><p>As shown in <a class="xref" href="RiderTutorialTrace.html#TutMessageTrace" title="Figure&nbsp;29.&nbsp;Fuse Integration perspective's message tracing components">Figure&nbsp;29</a>, the tooling draws the route in
                        <span class="guilabel">Diagram View</span>, tagging paths exiting a processing step
                    with timing and performance metrics (in milliseconds). Only the metric
                        <span class="guilabel">Total exchanges</span> is displayed in the diagram.</p><div class="figure"><a name="TutMessageTrace"></a><p class="title"><b>Figure&nbsp;29.&nbsp;Fuse Integration perspective's message tracing components</b></p><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="495"><tr><td align="center"><img src="images/ftTutFIP26_2.png" align="middle" width="495" alt="Message tracing in Fuse Integration perspective"></td></tr></table></div></div></div><br class="figure-break"><p>Hovering over the displayed metrics reveals additional metrics about message
                    flow, as shown in <a class="xref" href="RiderTutorialTrace.html#tutMsgMetrics" title="Figure&nbsp;30.&nbsp;Additional message metrics">Figure&nbsp;30</a>.</p><div class="figure"><a name="tutMsgMetrics"></a><p class="title"><b>Figure&nbsp;30.&nbsp;Additional message metrics</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/tutDVnodeMetrics.png" align="middle" width="283.2" alt="Additional message metrics revealed in Diagram View"></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>mean time the step took to process a message</p></li><li class="listitem"><p>maximum time the step took to process a message</p></li><li class="listitem"><p>minimum time the step took to process a message</p></li></ul></div></li><li class="step"><p>When done:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>In <span class="guilabel">JMX Navigator</span>, right-click
                                    <span class="guimenuitem">blueprintContext</span> and select
                                    <span class="guimenuitem">Stop Tracing Context</span> from the context
                                menu.</p></li><li class="listitem"><p>Open the <span class="guilabel">Console</span> and click the <span class="inlinemediaobject"><img src="images/ConsoleStopButton.jpg" alt="Stop icon"></span> button in the upper right of the panel to stop
                                the Console. Then click the <span class="inlinemediaobject"><img src="images/clear_co.png" alt="Clear icon"></span> button to clear console output.</p></li></ul></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12378"></a>Next steps</h2></div></div></div><p>After you create a JUnit test case for your project, you can run your project with it,
            as described in <a class="xref" href="RiderTutorialJUnit.html" title="To Test a Route with JUnit"><i>To Test a Route with JUnit</i></a>.</p></div></div></body></html>