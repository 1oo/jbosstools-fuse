<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Mock</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="keywords" content="Apache Camel, Open Source, open source, Fuse, Red Hat, EIP, Enterprise Integration Patterns"><meta name="keywords" content="Apache Camel, Open Source, open source, Fuse, Red Hat, EIP, Enterprise Integration Patterns"><link rel="home" href="index.html" title="Red Hat Fuse IDE"><link rel="up" href="RiderTestEptRef.html" title="Testing Endpoints"><link rel="prev" href="RiderTestEptRef.html" title="Testing Endpoints"><link rel="next" href="test.html" title="Test"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="refentry"><a name="mock"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>Mock &#8212; provides a declarative framework for testing routes</p></div><div class="refsection"><a name="d0e35241"></a><h2>Overview</h2><p>Mock endpoints provide a powerful declarative testing mechanism similar to 
      <a class="link" href="http://jmock.org" target="_top">jMock</a>. It allows declarative expectations to be 
      created on any Mock endpoint before a test begins. When the test is run, which typically 
      fires messages to one or more endpoints, the expectations can be asserted in a test case to 
      ensure the system worked as expected.</p><p>This allows you to test things like:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The correct number of messages are received on each endpoint</p></li><li class="listitem"><p>The correct payloads are received and in the right order</p></li><li class="listitem"><p>Messages arrive on an endpoint in the right order</p></li><li class="listitem"><p>Messages arrive on an endpoint in order according to some <code class="filename">Expression</code> that
                implements an order testing function</p></li><li class="listitem"><p>Arriving messages match some kind of predicate (such as specific headers that have
                    specific values) or message parts match some predicate (such as evaluation by an
                        <code class="filename">XPath</code> or <code class="filename">XQuery</code> expression) </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <a href="PLUGINS_ROOT/com.fusesource.rider.help/test.html" class="olink">Test endpoint</a> is a mock endpoint that uses a 
        second endpoint to provide the list of expected message bodies and automatically sets up 
        the mock endpoint assertions.</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Mock endpoints keep received Exchanges in memory indefinitely. When you add Mock endpoints to
                a route, each Exchange sent to those endpoints is stored in memory (for later
                validation) until an explicit reset or the JVM is restarted. Sending large messages
                or a high volume of messages may result in excessive memory use. If your goal is to
                test deployable routes inline, use <code class="filename">NotifyBuilder</code> or
                    <code class="filename">AdviceWith</code> in your test, instead of adding Mock endpoints
                directly to routes.</p><p>Alternatively, you can use the <code class="literal">retainFirst</code> and
                    <code class="literal">retainLast</code> options together to limit the number of Exchanges
              that Mock endpoints retain in memory. See <a class="xref" href="mock.html#MockExchngLimit" title="Limiting the number of Exchanges to keep">Limiting the number of Exchanges to keep</a>.</p></td></tr></table></div></div><div class="refsection"><a name="d0e35301"></a><h2>Dependencies</h2><p>Maven users will need to add the dependency shown in <a class="xref" href="mock.html#mockPOM" title="Example&nbsp;18.&nbsp;Mock dependency">Example&nbsp;18, &#8220;Mock dependency&#8221;</a> to their
      <code class="filename">pom.xml</code> to use this component.</p><div class="example"><a name="mockPOM"></a><p class="title"><b>Example&nbsp;18.&nbsp;Mock dependency</b></p><div class="example-contents"><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-test<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div></div><br class="example-break"></div><div class="refsection"><a name="d0e35316"></a><h2>URI format</h2><p>Mock endpoints have the following URI format:</p><pre class="programlisting">mock:<em class="replaceable"><code>someName</code></em>[?<em class="replaceable"><code>options</code></em>]</pre><p><em class="replaceable"><code>someName</code></em> can be any string that uniquely identifies the 
    endpoint.</p></div><div class="refsection"><a name="d0e35333"></a><h2>Options</h2><p><a class="xref" href="mock.html#MockRefTbl010" title="Table&nbsp;49.&nbsp;Mock options">Table&nbsp;49, &#8220;Mock options&#8221;</a> describes the options for a mock endpoint.</p><div class="table"><a name="MockRefTbl010"></a><p class="title"><b>Table&nbsp;49.&nbsp;Mock options</b></p><div class="table-contents"><table summary="Mock options" border="1"><colgroup><col width="33%"><col width="33%"><col width="34%"></colgroup><thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code class="code">retainFirst</code></td><td>&nbsp;</td><td>Specifies the number of first Exchanges to retain in memory.</td></tr><tr><td><code class="code">retainLast</code></td><td>&nbsp;</td><td>Specifies the number of last Exchanges to retain in memory.</td></tr><tr><td><code class="code">reportGroup</code></td><td><code class="code">null</code></td><td>Specifies a size to use for a throughput logger for reporting.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="refsection"><a name="MockExchngLimit"></a><h2>Limiting the number of Exchanges to keep</h2><p>You can use the <code class="literal">retainFirst</code> and <code class="literal">retainLast</code> options
            together to instruct Mock endpoints to retain only the specified number of first and
            last Exchanges in memory. The following code snippet retains a copy of the first five
            and last five Exchanges that the Mock endpoint receives:</p><pre class="programlisting">MockEndpoint mock = getMockEndpoint("mock:data");
mock.setRetainFirst(5);
mock.setRetainLast(5);
mock.expectedMessageCount(2000);
   ...
mock.assertIsSatisfied();
      </pre><p>Some limitations are associated with using these options. The
                <code class="literal">getExchanges()</code> and <code class="literal">getReceivedExchanges()</code>
            methods on the <code class="literal">MockEndpoint</code> return only the retained copies of the
            Exchanges. So, for our example snippet, the returned list would contain only ten
            Exchanges&#8212;the first five and the last five.</p><p>The <code class="literal">retainFirst</code> and <code class="literal">retainLast</code> options also limit
            which expectation methods you can use. For example, the
                <code class="literal">expected</code><em class="replaceable"><code>XXX</code></em> methods that work on
            message bodies, headers, and so on, work only on retained messages. For our example
            snippet, <code class="literal">expected</code><em class="replaceable"><code>XXX</code></em> methods would test
            expectations only on the ten retained Exchanges.</p></div></div></body></html>